# ADRSZSB ゼロワン　サーボ拡張基板　サンプルPythonスクリプト/ライブラリ取り扱い説明書  

### *製品ページは[こちら](http://bit-trade-one.co.jp/product/module/adrszsb)*

### [回路図](https://github.com/bit-trade-one/RasPi-Zero-One-Series/blob/master/1st/ADRSZSB_Servo_Motor/Schematics/rpizeroservo_v11_schematics.pdf)

## サンプルスクリプト ADRSZSB_Sample.pyについて  
このスクリプトは、ADRSZSB ゼロワンサーボ拡張基板専用 サーボ制御サンプルプログラムです。  
コマンドを受け付け、設定値に応じて2つのサーボモータの独立制御を行うことができます。  
  
コマンドには以下の8種類があります。  

|操作|コマンド|読み書き|範囲など|
|:-:|:-:|:-:|:-:|
|Duty幅設定|d|r/w|Duty幅下限値～上限値|
|PWM周期設定|c|r/w|10000～30000µ秒|
|Duty幅上限値設定|x|r/w|0～PWM周期値|
|Duty幅下限値設定|n|r/w|0～Duty幅上限値|
|設定値書き込み指令|r|w|設定値を反映させる|
|全CH一斉Duty幅設定|a|r/w|Duty幅下限値～上限値|
|サーボ電源切り替え指令|s|r/w|1 (ON) / 0 (OFF)|
|スクリプト終了|q|w|ターミナルに戻る|
|||  
  

コマンドd/c/x/nを実行し設定値を書き込んだ場合は、設定値を反映させるためにコマンドrを実行する必要があります。この時、複数の設定値を一度に反映させることができます。  
例として、コマンドx→n→dを実行し設定値を書き込んだあとコマンドrを実行した場合、Duty幅上限値、下限値、Duty幅の3つが変更されます。この時、各設定値に矛盾が発生しないよう、PWM周期→Duty幅上限値→Duty幅下限値→Duty幅の順に値がセットされ、矛盾する場合は先に設定された値に、後から設定される値が依存する形で値が変更されます。また、矛盾が発生している場合は警告文が表示されます。  

コマンドc/x/nの設定値を書き込むには、事前に設定したいサーボチャンネルの電源をOFFにする必要があります。OFFにしていなかった場合は注意文が出るので、サーボ電源をOFFにしてからコマンドrを実行し、その後サーボ電源をONにしてください。  

## ライブラリ SVO.py について  

ライブラリはクラスの形で提供されています。そのため、  

```py
import SVO
```

でライブラリをインポートし、  

```py
servo = SVO.SVO()
```

として初期化を行い(変数名は任意)、メンバ・メソッドには  

```py
servo.Get_servo_duty("1")
```

のようにしてアクセスしてください。  
また、このライブラリではSMBusライブラリ、structライブラリをインポートしています。そのため、メインスクリプト内にてこれらのライブラリをインポートする必要はありません。SMBusライブラリのメソッドには、変数'i2c'でアクセスできます。  

## 関数

---------------------------------

## Servo_Switch(ch,sw_str)

指定したチャンネルのサーボの電源を切り替えます。  
ch:チャンネル指定　　'1' / '2' / 'b'　　'b'は”both”、両チャンネル同時設定  
sw_str:スイッチ指定　'0' / '1'　　0=サーボOFF、1=サーボON  

---------------------------------

## Set_servo_duty(ch,val_str)

指定したチャンネルのDuty幅を設定します。  
ch:チャンネル指定　　'1' / '2' / 'b'　　'b'は”both”、両チャンネル同時設定  
val_str:設定Duty幅(μ秒、符号なし2バイト)

---------------------------------

## Set_servo_duty_isolate(ch1_val_str,ch2_val_str)

全チャンネルに一斉にDuty幅をセットし、反映します。  
ch1_val_str:チャンネル1　設定Duty幅(μ秒、符号なし2バイト)  
ch2_val_str:チャンネル2　設定Duty幅(μ秒、符号なし2バイト)  

---------------------------------

## Set_servo_duty_max(ch,val_str)

指定したチャンネルのDuty幅上限値を設定します。  
ch:チャンネル指定　　'1' / '2' / 'b'　　'b'は”both”、両チャンネル同時設定  
val_str:設定Duty幅(μ秒、符号なし2バイト)  
※設定先のサーボチャンネルの電源がONの場合、注意文が表示されます。サーボの電源を切ってからコマンド'r'を実行してください。

---------------------------------

## Set_servo_duty_min(ch,val_str)

指定したチャンネルのDuty幅下限値を設定します。  
ch:チャンネル指定　　'1' / '2' / 'b'　　'b'は”both”、両チャンネル同時設定  
val_str:設定Duty幅下限値(μ秒、符号なし2バイト)  
※設定先のサーボチャンネルの電源がONの場合、注意文が表示されます。サーボの電源を切ってからコマンド'r'を実行してください。

---------------------------------

## Set_servo_cycle(val_str)

出力されるPWM信号の周期を設定します。
val_str:PWM周期長さ(μ秒、符号なし2バイト)

---------------------------------

## Set_servo_write

各種設定値の書き込み指令を送信します。

---------------------------------

## Get_servo_state(ch)

指定したチャンネルのサーボ電源状態を読み取ります。  
ch:チャンネル指定　　'1' / '2'  
返り値: 0(OFF) / 1(ON)  

---------------------------------

## Get_servo_duty(ch)

指定したチャンネルのDuty幅を読み取ります。  
ch:チャンネル指定　　'1' / '2'  
返り値: Duty幅(μ秒、符号なし2バイト)  

---------------------------------

## Get_servo_duty_isolate

全チャンネルのDuty幅を一斉に取得し、画面に表示します。  
単位はμ秒です。  

---------------------------------

## Get_servo_duty_max(ch)

指定したチャンネルのDuty幅上限値を読み取ります。  
ch:チャンネル指定　　'1' / '2'  
返り値: Duty幅上限値(μ秒、符号なし2バイト)  

---------------------------------

## Get_servo_duty_min(ch)

指定したチャンネルのDuty幅下限値を読み取ります。  
ch:チャンネル指定　　'1' / '2'  
返り値: Duty幅下限値(μ秒、符号なし2バイト)  

---------------------------------

## Get_servo_cycle

出力されるPWM信号の周期を読み取ります。  
返り値:PWM周期(μ秒、符号なし2バイト)  
